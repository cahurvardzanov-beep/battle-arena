<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Battle Arena</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial; background: #0e0e1a; color: white; text-align: center; padding: 20px; }
    h1 { color: #ff6b6b; }
    .unit { padding: 15px; margin: 10px; background: #1a1a2e; border-radius: 12px; cursor: pointer; }
    .unit:hover { background: #16213e; }
    button { padding: 15px 30px; font-size: 18px; background: #ff6b6b; border: none; border-radius: 12px; color: white; margin: 20px; }
    #army { margin: 20px; padding: 20px; background: #16213e; border-radius: 12px; }
  </style>
</head>
<body>
  <h1>Battle Arena</h1>
  <p>Собери армию и сражайся!</p>

  <div id="army">
    <div class="unit" onclick="addUnit('infantry')">Пехота (120)</div>
    <div class="unit" onclick="addUnit('archer')">Лучники (80)</div>
    <div class="unit" onclick="addUnit('cavalry')">Кавалерия (50)</div>
    <div class="unit" onclick="addUnit('siege')">Осада (20)</div>
  </div>

  <div id="selected-army">
    <h3>Твоя армия:</h3>
    <pre id="army-list">Готова к бою!</pre>
  </div>

  <button onclick="saveArmy()">Сохранить армию</button>
  <button onclick="startBattle()">Начать битву!</button>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    let army = { infantry: 0, archer: 0, cavalry: 0, siege: 0 };

    function addUnit(type) {
      if (type === 'infantry') army.infantry += 10;
      if (type === 'archer') army.archer += 5;
      if (type === 'cavalry') army.cavalry += 3;
      if (type === 'siege') army.siege += 1;
      updateArmyDisplay();
    }

    function updateArmyDisplay() {
      const list = Object.entries(army)
        .filter(([_, count]) => count > 0)
        .map(([type, count]) => `${type}: ${count}`)
        .join('\n') || 'Пусто';
      document.getElementById('army-list').textContent = list;
    }

    function saveArmy() {
      tg.sendData(JSON.stringify({
        action: "save_army",
        army: army,
        points: Object.values(army).reduce((a, b) => a + b, 0) * 10
      }));
      tg.close();
    }

    function startBattle() {
      tg.sendData(JSON.stringify({
        action: "start_battle",
        army: army
      }));
      alert("Битва началась!");
    }

    // Приветствие
    document.body.innerHTML += `<p>Привет, ${tg.initDataUnsafe.user?.first_name || 'Воин'}!</p>`;
  </script>
</body>
</html>